<Page x:Class="UnoApp1.Presentation.MainPage"
      x:Name="PageRoot"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:um="using:Uno.Material"
      xmlns:local="using:UnoApp1.Presentation"
      xmlns:models="using:UnoApp1.Models">

    <Grid utu:SafeArea.Insets="VisibleBounds">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <utu:NavigationBar Content="{Binding Title}" Grid.Row="0">
            <utu:NavigationBar.PrimaryCommands>
                <AppBarButton Label="Giỏ hàng" 
                  Command="{Binding GoToCartCommand}">
                    <Grid>
                        <SymbolIcon Symbol="Shop" />

                        <Border Background="Red" 
                CornerRadius="10" 
                VerticalAlignment="Top" 
                HorizontalAlignment="Right" 
                Margin="10,0,0,10"
                MinWidth="16" Height="16"
                Visibility="{Binding CartCount, Converter={StaticResource CountToVisibilityConverter}}">

                            <TextBlock Text="{Binding CartCount}" 
                       Foreground="White" 
                       FontSize="10" 
                       HorizontalAlignment="Center" 
                       VerticalAlignment="Center"/>
                        </Border>
                    </Grid>
                </AppBarButton>
            </utu:NavigationBar.PrimaryCommands>
        </utu:NavigationBar>

        <GridView Grid.Row="1" 
          ItemsSource="{Binding Products}"
          Padding="10"
          SelectionMode="None">
            <GridView.ItemContainerStyle>
                <Style TargetType="GridViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <Setter Property="VerticalContentAlignment" Value="Stretch" />
                </Style>
            </GridView.ItemContainerStyle>

            <GridView.ItemTemplate>
                <DataTemplate>
                    <Button Style="{StaticResource MaterialOutlinedButtonStyle}"
                    Command="{Binding DataContext.GoToDetailCommand, ElementName=PageRoot}"
                    CommandParameter="{Binding}"
                    Margin="5" Padding="0"
                    CornerRadius="12"  
                    BorderThickness="1"
                    BorderBrush="#E0E0E0"
                    Background="White">
                        <Grid Width="150">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="160"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Image Grid.Row="0" 
                           Source="{Binding imageUrl}" 
                           Stretch="Uniform" 
                           Margin="10"/>

                            <TextBlock Grid.Row="1" 
                               Text="{Binding product_name}" 
                               FontWeight="SemiBold" 
                               FontSize="14"
                               TextTrimming="CharacterEllipsis" 
                               MaxLines="2" 
                               Margin="10,0,10,5"
                               Height="40"/>
                            <TextBlock Grid.Row="2" 
                               Foreground="#D32F2F" 
                               FontWeight="Bold" 
                               FontSize="16"
                               Margin="10,0,10,15">
                                    <Run Text="{Binding price}" />
                                    <Run Text=" đ" FontSize="12"/>      
                            </TextBlock>
                        </Grid>
                    </Button>
                </DataTemplate>
            </GridView.ItemTemplate>
        </GridView>
    </Grid>
</Page>
